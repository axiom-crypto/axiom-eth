name: Tests

on:
  push:
    branches: ["main", "develop", "community-edition"]
  pull_request:
    branches: ["main", "develop", "community-edition"]

env:
  CARGO_TERM_COLOR: always
  INFURA_ID: ${{ vars.INFURA_ID }}
  JSON_RPC_URL: ${{ vars.JSON_RPC_URL }}

jobs:
  build:
    runs-on: ubuntu-latest-m

    steps:
      - uses: actions/checkout@v3
      - name: Build
        run: cargo build --verbose
      - name: Run axiom-eth tests MockProver
        run: |
          export INFURA_ID=${{ vars.INFURA_ID }}
          export JSON_RPC_URL=${{ vars.JSON_RPC_URL }}
          cd axiom-eth
          cargo test -- test_mock_account_queries_empty
          cargo test -- test_mock_account_queries_genesis
          cargo test -- test_mock_account_queries_simple
          cargo test -- test_genesis_block
          cargo test -- test_mock_block_queries_random
          cargo test -- test_mock_row_consistency_nouns
          cargo test -- test_default_storage_query
          cargo test -- test_mock_storage_queries_empty
          cargo test -- test_mock_storage_queries_mapping
          cargo test -- test_mock_storage_queries_slot0
          cargo test -- test_mock_storage_queries_uni_v3
          cargo test -- test_multi_goerli_header_mock
          cargo test -- test_one_mainnet_header_before_london_mock
          cargo test -- test_one_mainnet_header_mock
          cargo test -- test_one_mainnet_header_withdrawals_mock
          cargo test -- test_keccak
          cargo test -- test_mock_mpt_inclusion_fixed
          cargo test -- test_mpt_empty_root
          cargo test -- test_mpt_noninclusion_branch_fixed
          cargo test -- test_mpt_noninclusion_extension_fixed
          cargo test -- test_mock_small_val
          cargo test -- test_mock_rlc
          cargo test -- test_mock_rlp_array
          cargo test -- test_mock_rlp_field
          cargo test -- test_mock_rlp_literal
          cargo test -- test_mock_rlp_long_field
          cargo test -- test_mock_rlp_long_long_field
          cargo test -- test_mock_rlp_short_field
          cargo test -- test_mock_single_eip1186
          cargo test -- pos_full_tree_test_inclusion --test-threads=1 
          cargo test -- neg_full_tree_test_inclusion_badval --test-threads=1 
          cargo test -- pos_test_noninclusion --test-threads=1 
          cargo test -- neg_invalid_max_depth --test-threads=1 
          cargo test -- neg_invalid_max_depth_panic --test-threads=1 
          cargo test -- neg_invalid_max_key_byte_len --test-threads=1 
          cargo test -- neg_invalid_max_key_byte_len_panic --test-threads=1 
          cargo test -- neg_invalid_key_byte_len --test-threads=1 
          cargo test -- pos_empty_tree_noninclusion --test-threads=1 
          cargo test -- neg_empty_tree_invalid_depth --test-threads=1 
          cargo test -- neg_nonempty_tree_empty_proof --test-threads=1 
          cargo test -- test_mock_single_tx_legacy
          cargo test -- test_mock_multi_tx_legacy
          cargo test -- test_mock_zero_tx_legacy
          cargo test -- test_mock_single_tx_new
          cargo test -- test_mock_multi_tx_new
          cargo test -- stress_test
          cargo test -- test_invalid_block_header
          cargo test -- test_valid_root_wrong_block_header
          cargo test -- test_invalid_key
          cargo test -- test_mock_single_tx_len_legacy
          cargo test -- test_mock_multi_tx_len_legacy
          cargo test -- test_mock_zero_len_new
          cargo test -- test_mock_zero_len_legacy
          cargo test -- test_mock_one_len_new
          cargo test -- test_mock_one_len_legacy
          cargo test -- test_mock_nonzero_len_new
          cargo test -- test_mock_nonzero_len_legacy
