[package]
name = "halo2-mpt"
version = "0.0.1"
edition = "2021"

[[bin]]
name = "gen_srs"
required-features = ["plonk_verifier"]

[[bin]]
name = "bootstrap_history"
required-features = ["aggregation", "clap"]

# [patch.crates-io]
# bitvec = { git = "https://github.com/ed255/bitvec.git", rev = "5cfc5fa8496c66872d21905e677120fc3e79693c" }
# halo2_proofs = { git = "https://github.com/privacy-scaling-explorations/halo2.git", tag = "v2022_09_10" }

[patch."https://github.com/privacy-scaling-explorations/halo2"]
halo2_proofs = { git = "https://github.com/axiom-crypto/halo2.git", branch = "axiom/add-serialization", package = "halo2_proofs" }

[patch."https://github.com/privacy-scaling-explorations/zkevm-circuits"]
zkevm-circuits = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new" }
eth-types = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new" }
keccak256 = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new" }

[dependencies]
itertools = "0.10"
lazy_static = "1.4.0"
num-bigint = { version = "0.4", features = ["rand"] }
num-integer = "0.1"
num-traits = "0.2"

# halo2
ff = "0.12.0"
group = "0.11"
halo2_base = { git = "ssh://github.com/axiom-crypto/halo2-lib-working.git", package = "halo2_base", default-features = false }
halo2_proofs = { git = "https://github.com/privacy-scaling-explorations/halo2.git", tag = "v2022_09_10" }
halo2_curves = { git = "https://github.com/privacy-scaling-explorations/halo2curves", tag = "0.3.0", package = "halo2curves" }

# crypto
rlp = "0.5.1"
sha3 = "0.10.5"
rand_core = { version = "0.6", default-features = false, features = ["getrandom"] }
rand = "0.8"
rand_chacha = "0.3.1"

# misc
hex = "0.4.3"
serde = { version = "1.0", default-features = false, features = ["derive"] }
serde_json = { version = "1.0", default-features = false }
ark-std = { version = "0.3.0", features = ["print-trace"] }
clap = { version = "4.0.13", features = ["derive"], optional = true }

# aggregation 
plonk_verifier = { git = "https://github.com/jonathanpwang/plonk-verifier.git", default-features = false, features = ["loader_evm", "loader_halo2", "system_halo2"], optional = true }

# evm verifier 
ethereum_types = { package = "ethereum-types", version = "0.13.1", default-features = false, features = ["std"], optional = true }
foundry_evm = { git = "https://github.com/jonathanpwang/foundry", package = "foundry-evm", branch = "fix/pin-revm-to-rev", optional = true }

# generating circuit inputs from blockchain
ethers-providers = { git = "https://github.com/gakonst/ethers-rs", optional = true }  
ethers-core = { git = "https://github.com/gakonst/ethers-rs", optional = true }  
tokio = { version = "1.18", optional = true }
bincode = { version = "1.3.3", optional = true }

# zkevm
ecdsa = { git = "https://github.com/privacy-scaling-explorations/halo2wrong", tag = "v2022_09_09", optional = true }
ecc =       { git = "https://github.com/privacy-scaling-explorations/halo2wrong", tag = "v2022_09_09", optional = true }
eth-types = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new" }
keccak256 = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new", optional = true }
maingate =  { git = "https://github.com/privacy-scaling-explorations/halo2wrong", tag = "v2022_09_09", optional = true }
integer =   { git = "https://github.com/privacy-scaling-explorations/halo2wrong", tag = "v2022_09_09", optional = true }
zkevm-circuits = { git = "https://github.com/yi-sun/zkevm-circuits.git", branch = "expose-keccak-new", optional = true }

# plot 
plotters = { version = "0.3.0", optional = true }
tabbycat = { version = "0.1", features = ["attributes"], optional = true }

[target.'cfg(not(target_env = "msvc"))'.dependencies]
jemallocator = { version = "0.3.2", optional = true }

[dev-dependencies]

[features]
default = ["display", "aggregation", "clap", "jemalloc", "serialize"]
zkevm = ["dep:ecdsa", "dep:ecc", "dep:keccak256", "dep:maingate", "dep:integer", "dep:zkevm-circuits"]
aggregation = ["plonk_verifier", "input_gen"]
evm = ["dep:ethereum_types", "dep:foundry_evm"]
input_gen = ["dep:ethers-providers", "dep:ethers-core", "dep:tokio", "dep:bincode"]
dev-graph = ["halo2_proofs/dev-graph", "plotters"]
jemalloc = ["dep:jemallocator"]
display = ["halo2_base/display", "plonk_verifier/display"]
serialize = ["plonk_verifier/serialize"]
debug = ["halo2_base/debug"]

[profile.release]
debug = true
